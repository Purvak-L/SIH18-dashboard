<html>
<head>
    <script type="text/javascript" src="dist/vis.js"></script>
    <link href="dist/vis.css" rel="stylesheet" type="text/css" />

    <style type="text/css">
        #mynetwork {
            width: 600px;
            height: 400px;
            border: 1px solid lightgray;
            background-image: url('bg.jpg');
        }
    </style>
</head>
<body onload="doLoad()">
    <script type="text/javascript" src="reader.js"></script>
<div id="mynetwork"></div>

<script type="text/javascript">

    var conn_status_json ;

    function doLoad() {
    // ws = new WebSocket("ws://192.168.43.86:50008");
    ws = new WebSocket("ws://127.0.0.1:50008");
    ws.onmessage = function (evt) {
        // console.log(evt.data);
        data = JSON.parse(evt.data);
        if (data.type == "drone_conn") {

            function drawNodes(n,x_,y_){  
             for (i = 0; i < n; i++) {
                // console.log(x_[i]+" "+y_[i]);
                 nodes.add([{x:x_[i],y:y_[i],id: i, label: "drone "+i, shape: 'image', image: 'drone_marker_dead.png'}]);
                }
            } 

            function drawEdges(a, b){  
                edges.add([{from:a, to:b, color:{color: "green"}}]);
                turnAlive(a);
                turnAlive(b);
                network.redraw();
            } 
                          
            function turnAlive(node) {
                 nodes.update([{id: node, shape: 'image', image: 'drone_marker_alive.png'}]) ;  
            }

            conn_status_json = data;
            // console.log(conn_status_json);
            var nodes = new vis.DataSet([]);
            var edges = new vis.DataSet([]);

            // create a network
            var container = document.getElementById('mynetwork'); 
                 
            var x = [240, 200, 300, 500];
            var y = [300, 250, 100, 50];
            drawNodes(4,x,y);
                 
            var data = {
            nodes: nodes,
            edges: edges
            };
                 
            var options = {}    
            
            var obj = JSON.parse('{"connection":["1,2","1,0","1,3"]}');
            console.log(conn_status_json);

            var network = new vis.Network(container, data, options);
            
            for(i = 0; i < obj.connection.length; i++) {
                var x = obj.connection[i].split(",");
                drawEdges(x[0], x[1]);
                }     
            }
        }
    }
    
</script>
</body>
</html>
    